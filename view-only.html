<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø±ÙˆØ¶</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* Ø§Ø­ØªÙØ¸ Ø¨Ù†ÙØ³ Ø§Ù„Ù€ CSS ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© */
    body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      margin: 0; 
      padding: 20px; 
      min-height: 100vh; 
    }
    .container { 
      max-width: 1900px; 
      margin: 0 auto; 
      background: white; 
      padding: 25px; 
      border-radius: 12px; 
      box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
    }
    h2 { 
      text-align: center; 
      color: #2c3e50; 
      margin-top: 0; 
      font-size: 28px; 
      margin-bottom: 10px; 
    }
    .stats { 
      display: flex; 
      gap: 20px; 
      justify-content: center; 
      margin-bottom: 20px; 
    }
    .stat-card { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      padding: 15px 30px; 
      border-radius: 8px; 
      text-align: center; 
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); 
      transition: transform 0.3s; 
    }
    .stat-card:hover { 
      transform: translateY(-5px); 
    }
    .stat-card .label { 
      font-size: 14px; 
      opacity: 0.9; 
    }
    .stat-card .value { 
      font-size: 24px; 
      font-weight: bold; 
      margin-top: 5px; 
    }
    .filters { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 15px; 
      margin: 20px 0; 
      padding: 15px; 
      background: #f8f9fa; 
      border-radius: 8px; 
    }
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .filter-label {
      font-size: 13px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 2px;
    }
    select, input { 
      width: 100%; 
      padding: 10px; 
      border: 2px solid #e0e0e0; 
      border-radius: 6px; 
      transition: all 0.3s; 
      font-size: 14px; 
    }
    select:focus, input:focus { 
      outline: none; 
      border-color: #667eea; 
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); 
    }
    .committee-filter {
      position: relative;
      grid-column: span 2;
    }
    .committee-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 2px solid #667eea;
      border-radius: 6px;
      max-height: 300px;
      overflow-y: auto;
      width: 100%;
      z-index: 100;
      display: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .committee-dropdown.show {
      display: block;
    }
    .committee-item {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .committee-item:hover {
      background: #f0f4f8;
    }
    .committee-item input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .committee-toggle {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      cursor: pointer;
      background: white;
      text-align: right;
    }
    .committee-toggle:hover {
      border-color: #667eea;
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    }
    th, td { 
      border: 1px solid #e0e0e0; 
      padding: 12px 8px; 
      text-align: right; 
      font-size: 13px; 
    }
    th { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      position: sticky; 
      top: 0; 
      z-index: 10; 
    }
    th input, th select { 
      width: 95%; 
      padding: 6px; 
      margin-top: 8px; 
      border: 1px solid #fff; 
      border-radius: 4px; 
      font-size: 12px; 
      background: rgba(255,255,255,0.95); 
    }
    tr:nth-child(even) { 
      background-color: #f8f9fa; 
    }
    tr:hover:not(.detail-row) { 
      background-color: #e3f2fd; 
      transition: background-color 0.3s; 
    }
    .expand-btn { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      border: none; 
      padding: 6px 12px; 
      border-radius: 4px; 
      cursor: pointer; 
      transition: all 0.3s; 
      font-weight: bold; 
    }
    .expand-btn:hover { 
      transform: scale(1.1); 
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); 
    }
    .detail-row { 
      display: none; 
      background: #f0f4f8; 
    }
    .detail-row td { 
      padding: 20px; 
      line-height: 1.8; 
    }
    .loading { 
      text-align: center; 
      padding: 40px; 
      color: #777; 
    }
    .error { 
      color: #e74c3c; 
      text-align: center; 
      padding: 20px; 
    }
    .btn-apply { 
      grid-column: span 2; 
      padding: 12px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      border: none; 
      border-radius: 6px; 
      font-size: 16px; 
      font-weight: bold; 
      cursor: pointer; 
      transition: all 0.3s; 
    }
    .btn-apply:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); 
    }
    .selected-committees {
      font-size: 12px;
      color: #667eea;
      margin-top: 4px;
    }
    .approved-cell {
      background-color: #e6ffe6; 
      color: #008000; 
      font-weight: bold;
    }
    .rejected-cell {
      background-color: #ffe6e6; 
      color: #cc0000; 
      font-weight: bold;
    }
    .detail-container {
        padding: 10px;
    }
    .detail-row-sections {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px dashed #d0d0d0;
    }
    .detail-section h3 {
        color: #764ba2;
        font-size: 18px;
        margin-top: 0;
        margin-bottom: 15px;
        border-bottom: 2px solid #764ba2;
        padding-bottom: 5px;
    }
    .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
    }
    .detail-label {
        font-weight: bold;
        color: #2c3e50;
        flex-basis: 50%;
        text-align: right;
        padding-left: 10px;
    }
    .detail-value {
        flex-basis: 50%;
        text-align: left;
        color: #555;
    }
    .detail-section-full h3 {
        color: #2ecc71;
        font-size: 18px;
        margin-top: 0;
        margin-bottom: 15px;
        border-bottom: 2px solid #2ecc71;
        padding-bottom: 5px;
    }
    
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¬Ø§Ù† Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ÙˆØ§Ù„Ù…Ù†ØµØ±ÙØ© */
    .committee-type-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
    }
    .committee-type-item:hover {
      background: #f0f4f8;
    }
    .committee-type-label {
      font-size: 13px;
      font-weight: bold;
      color: #2c3e50;
    }
    .committee-type-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
      margin-right: 5px;
    }
    .badge-raised {
      background-color: #4caf50;
      color: white;
    }
    .badge-spent {
      background-color: #ff9800;
      color: white;
    }
    .committee-search-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h2>

    <div class="stats">
      <div class="stat-card">
        <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
        <div class="value" id="totalRecords">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</div>
        <div class="value" id="totalAmount">0</div>
      </div>
    </div>

    <div class="filters" id="filters">
      <div class="filter-group">
        <label class="filter-label">Ø§Ù„ÙØ±Ø¹</label>
        <select id="filterBranch">
          <option value="">Ø§Ù„ÙƒÙ„</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</label>
        <select id="filterReview">
          <option value="">Ø§Ù„ÙƒÙ„</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</label>
        <select id="filterSupervisor">
          <option value="">Ø§Ù„ÙƒÙ„</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
        <select id="filterAdmin">
          <option value="">Ø§Ù„ÙƒÙ„</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Ø§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
        <select id="filterOfficer">
          <option value="">Ø§Ù„ÙƒÙ„</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <select id="filterTransferred">
          <option value="">Ø§Ù„ÙƒÙ„</option>
          <option value="true">Ù†Ø¹Ù…</option>
          <option value="false">Ù„Ø§</option>
        </select>
      </div>
      
      <div class="filter-group committee-filter">
        <label class="filter-label">Ø§Ù„Ù„Ø¬Ø§Ù† Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©/Ø§Ù„Ù…Ù†ØµØ±ÙØ©</label>
        <div class="committee-toggle" onclick="toggleCommitteeDropdown()">
          <span>Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¬Ø§Ù†</span>
          <div class="selected-committees" id="selectedCommitteesText"></div>
        </div>
        <div class="committee-dropdown" id="committeeDropdown">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      
      <button onclick="resetFilters()" class="btn-apply">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±</button>
    </div>

    <div class="table-wrapper">
      <div id="tableContainer">
        <div class="loading" id="loadingMessage">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
      </div>
    </div>
  </div>

  <script>
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø£ÙˆÙ„Ø§Ù‹
    function validateSession() {
      const userId = localStorage.getItem('loggedInUserId');
      const userFullName = localStorage.getItem('loggedInUser');
      
      if (!userId || !userFullName) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ù‹Ø§!");
        window.location.href = "index.html";
        return false;
      }
      
      return true;
    }

    // ØªØ¹Ø±ÙŠÙ Supabase - Ù†Ø³Ø®Ø© Ù…Ù†ÙØµÙ„Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ø§Ø±Ø¶
    let db;
    try {
      db = window.supabase.createClient(
        'https://akjyrmmqsnxdbkslxmvb.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFranlybW1xc254ZGJrc2x4bXZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4ODUxODcsImV4cCI6MjA4MDQ2MTE4N30.EuTd_i9fEecFGJG89PhRa3z68k5x6nflOW6fvqvMQJM'
      );
    } catch (error) {
      console.error('ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
      showError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
    }

    let allData = [];
    let userRole = '';
    let userBranches = [];
    let filteredData = [];
    let selectedCommittees = [];
    let columnFilters = {
      nationalId: '',
      clientId: '',
      clientName: '',
      project: '',
      guarantorId: '',
      guarantorName: ''
    };
    let searchTimeout = null;

    function showError(message) {
      document.getElementById('tableContainer').innerHTML = `<div class="error">${message}</div>`;
    }

    function showLoading(message) {
      document.getElementById('loadingMessage').textContent = message;
    }

    async function init() {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø£ÙˆÙ„Ø§Ù‹
      if (!validateSession()) {
        return;
      }

      const userId = localStorage.getItem('loggedInUserId');
      
      try {
        showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...');
        
        // Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage Ø£ÙˆÙ„Ø§Ù‹ (Ù…Ù† index.html)
        userRole = localStorage.getItem('userRole') || '';
        const branchesStr = localStorage.getItem('userBranches') || '[]';
        userBranches = JSON.parse(branchesStr);
        
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªÙˆÙØ±Ø© ÙÙŠ localStorageØŒ Ù†Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!userRole) {
          const { data: user, error } = await db
            .from('users')
            .select('role, branches')
            .eq('id', userId)
            .single();

          if (error) throw error;
          
          userRole = user.role;
          userBranches = user.branches || [];
          
          // ØªØ®Ø²ÙŠÙ† ÙÙŠ localStorage Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
          localStorage.setItem('userRole', userRole);
          localStorage.setItem('userBranches', JSON.stringify(userBranches));
        }

        showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        await loadData();
        
        // Ø¥ØºÙ„Ø§Ù‚ dropdown Ø§Ù„Ù„Ø¬Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(e) {
          if (!e.target.closest('.committee-filter')) {
            document.getElementById('committeeDropdown').classList.remove('show');
          }
        });

      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', err);
        showError(`Ø®Ø·Ø£: ${err.message || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'}`);
      }
    }

    async function loadData() {
      try {
        let query = db.from('"Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ù…ÙˆÙ…Ø±ÙÙˆØ¹Ø© Ù„Ù„ØªÙ†ÙÙŠØ² ÙÙ‰ Ø§Ù„Ø¨Ù†Ùƒ"').select('*');
        
        // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„ÙØ±ÙˆØ¹ Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
        if (userRole !== 'admin' && userRole !== 'followup_supervisor' && userBranches && userBranches.length > 0) {
          // Ù†Ø¸Ø±Ø§Ù‹ Ù„Ø£Ù† VIEW Ø¬Ø¯ÙŠØ¯ØŒ Ù‚Ø¯ Ù†Ø­ØªØ§Ø¬ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯
          query = query.in('ÙØ±Ø¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„Ø£ØµÙ„ÙŠØ©', userBranches);
        }
        
        const { data, error } = await query.order('ØªØ§Ø±ÙŠØ®_Ø¥Ù†Ø´Ø§Ø¡_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', { ascending: false });

        if (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
          // Ø­Ø§ÙˆÙ„ Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙØ´Ù„
          try {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…...');
            const { data: oldData, error: oldError } = await db
              .from('operations_with_details')
              .select('*')
              .order('created_at', { ascending: false });
            
            if (oldError) throw oldError;
            
            allData = oldData || [];
            filteredData = [...allData];
            renderFilters();
            renderTable(filteredData);
            updateStats(filteredData);
            return;
          } catch (oldErr) {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø£ÙŠ Ù…ØµØ¯Ø±: ' + error.message);
          }
        }

        allData = data || [];
        filteredData = [...allData];
        renderFilters();
        renderTable(filteredData);
        updateStats(filteredData);

      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ loadData:', err);
        throw err;
      }
    }

    function renderFilters() {
      try {
        let branches = [];
        if (userRole === 'admin' || userRole === 'followup_supervisor') {
          branches = [...new Set(allData.map(row => row["ÙØ±Ø¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„Ø£ØµÙ„ÙŠØ©"] || row["Ø§Ù„ÙØ±Ø¹"]).filter(v => v && v.trim()))];
        } else if (userBranches && userBranches.length > 0) {
          branches = userBranches;
        }

        const branchSelect = document.getElementById('filterBranch');
        branchSelect.innerHTML = '<option value="">Ø§Ù„ÙƒÙ„</option>';
        branches.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v;
          opt.textContent = v;
          branchSelect.appendChild(opt);
        });

        const reviews = [...new Set(allData.map(row => row["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"]).filter(v => v && v.trim()))];
        const supervisors = [...new Set(allData.map(row => row["Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"]).filter(v => v && v.trim()))];
        const admins = [...new Set(allData.map(row => row["Ø§Ù„Ø§Ø¯Ø§Ø±Ø©"]).filter(v => v && v.trim()))];
        const officers = [...new Set(allData.map(row => row["Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØµØ§Ø¦Ù‰"]).filter(v => v && v.trim()))];
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù„Ø¬Ø§Ù† Ù…Ø¹ Ø§Ù„ØªØµÙ†ÙŠÙ
        const committees = extractCommittees(allData);

        const selects = [
          { id: 'filterReview', data: reviews },
          { id: 'filterSupervisor', data: supervisors },
          { id: 'filterAdmin', data: admins },
          { id: 'filterOfficer', data: officers }
        ];

        selects.forEach(item => {
          const select = document.getElementById(item.id);
          select.innerHTML = '<option value="">Ø§Ù„ÙƒÙ„</option>';
          item.data.forEach(v => {
            const opt = document.createElement('option');
            opt.value = v;
            opt.textContent = v;
            select.appendChild(opt);
          });
        });

        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø¬Ø§Ù†
        renderCommitteeFilter(committees);

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ø§Ù…Ø©
        ['filterBranch', 'filterReview', 'filterSupervisor', 'filterAdmin', 'filterOfficer', 'filterTransferred'].forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.addEventListener('change', applyAllFilters);
          }
        });

      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ renderFilters:', err);
      }
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ù„Ø¬Ø§Ù†
    function extractCommittees(data) {
      const committees = new Map();
      
      data.forEach(row => {
        const committeeNumber = row["Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©"];
        if (committeeNumber && committeeNumber.trim()) {
          // ØªØµÙ†ÙŠÙ Ø§Ù„Ù„Ø¬Ø§Ù† Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…
          const committeeStr = committeeNumber.toString().toLowerCase();
          let type = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          
          if (committeeStr.includes('Ù…Ø±ÙÙˆØ¹') || committeeStr.includes('Ø±ÙØ¹') || committeeStr.includes('Ù…Ø±ØªÙØ¹')) {
            type = 'Ù…Ø±ÙÙˆØ¹Ø©';
          } else if (committeeStr.includes('Ù…Ù†ØµØ±Ù') || committeeStr.includes('ØµØ±Ù') || committeeStr.includes('Ù…Ù†ÙÙ‚')) {
            type = 'Ù…Ù†ØµØ±ÙØ©';
          } else if (committeeStr.includes('Ù„Ø¬Ù†Ù‡') || committeeStr.includes('Ù„Ø¬Ù†Ø©') || committeeStr.includes('committee')) {
            type = 'Ù„Ø¬Ù†Ø©';
          }
          
          if (!committees.has(committeeNumber)) {
            committees.set(committeeNumber, {
              number: committeeNumber,
              type: type,
              count: 1
            });
          } else {
            committees.get(committeeNumber).count++;
          }
        }
      });
      
      return Array.from(committees.values()).sort((a, b) => {
        // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ø«Ù… Ø§Ù„Ø±Ù‚Ù…
        if (a.type !== b.type) {
          const typeOrder = { 'Ù…Ø±ÙÙˆØ¹Ø©': 1, 'Ù…Ù†ØµØ±ÙØ©': 2, 'Ù„Ø¬Ù†Ø©': 3, 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯': 4 };
          return typeOrder[a.type] - typeOrder[b.type];
        }
        return a.number.localeCompare(b.number);
      });
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ÙÙ„ØªØ± Ø§Ù„Ù„Ø¬Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
    function renderCommitteeFilter(committees) {
      const dropdown = document.getElementById('committeeDropdown');
      if (!dropdown) return;
      
      dropdown.innerHTML = '';
      
      // Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
      const searchDiv = document.createElement('div');
      searchDiv.style.padding = '8px';
      searchDiv.innerHTML = `
        <input type="text" class="committee-search-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù„Ø¬Ø§Ù†..." 
               oninput="filterCommittees(this.value)" />
      `;
      dropdown.appendChild(searchDiv);
      
      // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù„Ø¬Ø§Ù† Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
      const committeesByType = {
        'Ù…Ø±ÙÙˆØ¹Ø©': committees.filter(c => c.type === 'Ù…Ø±ÙÙˆØ¹Ø©'),
        'Ù…Ù†ØµØ±ÙØ©': committees.filter(c => c.type === 'Ù…Ù†ØµØ±ÙØ©'),
        'Ù„Ø¬Ù†Ø©': committees.filter(c => c.type === 'Ù„Ø¬Ù†Ø©'),
        'ØºÙŠØ± Ù…Ø­Ø¯Ø¯': committees.filter(c => c.type === 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')
      };
      
      // Ø¹Ø±Ø¶ ÙƒÙ„ Ù†ÙˆØ¹
      Object.entries(committeesByType).forEach(([type, typeCommittees]) => {
        if (typeCommittees.length > 0) {
          // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†ÙˆØ¹
          const typeHeader = document.createElement('div');
          typeHeader.className = 'committee-type-item';
          typeHeader.innerHTML = `
            <input type="checkbox" id="select-all-${type}" 
                   onchange="toggleAllCommittees('${type}', this.checked)">
            <span class="committee-type-label">
              <span class="committee-type-badge ${type === 'Ù…Ø±ÙÙˆØ¹Ø©' ? 'badge-raised' : type === 'Ù…Ù†ØµØ±ÙØ©' ? 'badge-spent' : ''}">
                ${type}
              </span>
              (${typeCommittees.length})
            </span>
          `;
          dropdown.appendChild(typeHeader);
          
          // Ø§Ù„Ù„Ø¬Ø§Ù† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹
          typeCommittees.forEach(committee => {
            const div = document.createElement('div');
            div.className = 'committee-item';
            div.setAttribute('data-type', type);
            div.setAttribute('data-number', committee.number);
            div.innerHTML = `
              <input type="checkbox" id="comm_${committee.number.replace(/[^a-zA-Z0-9]/g, '_')}" 
                     value="${committee.number}" onchange="updateSelectedCommittees()">
              <label for="comm_${committee.number.replace(/[^a-zA-Z0-9]/g, '_')}">
                ${committee.number}
                <small style="color: #666; margin-right: 5px;">(${committee.count})</small>
              </label>
            `;
            dropdown.appendChild(div);
          });
          
          // ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
          const separator = document.createElement('div');
          separator.style.height = '1px';
          separator.style.backgroundColor = '#eee';
          separator.style.margin = '5px 0';
          dropdown.appendChild(separator);
        }
      });
      
      // Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„
      const selectAllDiv = document.createElement('div');
      selectAllDiv.style.padding = '8px';
      selectAllDiv.style.borderTop = '1px solid #eee';
      selectAllDiv.innerHTML = `
        <button onclick="selectAllCommittees(true)" style="padding: 6px 12px; margin: 2px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„
        </button>
        <button onclick="selectAllCommittees(false)" style="padding: 6px 12px; margin: 2px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„
        </button>
      `;
      dropdown.appendChild(selectAllDiv);
    }

    // Ø¯Ø§Ù„Ø© Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù„Ø¬Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø­Ø«
    function filterCommittees(searchTerm) {
      const items = document.querySelectorAll('#committeeDropdown .committee-item');
      const searchLower = searchTerm.toLowerCase();
      
      items.forEach(item => {
        const committeeNumber = item.getAttribute('data-number');
        const committeeType = item.getAttribute('data-type');
        
        if (searchTerm === '') {
          item.style.display = 'flex';
        } else if (
          committeeNumber.toLowerCase().includes(searchLower) ||
          committeeType.toLowerCase().includes(searchLower) ||
          searchTerm.includes('Ù„Ø¬Ù†Ù‡') || searchTerm.includes('Ù„Ø¬Ù†Ø©') ||
          committeeNumber.includes(searchTerm)
        ) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Ø§Ø®ØªÙŠØ§Ø±/Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø¬Ø§Ù† Ù…Ù† Ù†ÙˆØ¹ Ù…Ø¹ÙŠÙ†
    function toggleAllCommittees(type, checked) {
      const checkboxes = document.querySelectorAll(`#committeeDropdown .committee-item[data-type="${type}"] input[type="checkbox"]`);
      checkboxes.forEach(cb => cb.checked = checked);
      updateSelectedCommittees();
    }

    // Ø§Ø®ØªÙŠØ§Ø±/Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø¬Ø§Ù†
    function selectAllCommittees(select) {
      const checkboxes = document.querySelectorAll('#committeeDropdown input[type="checkbox"]');
      checkboxes.forEach(cb => {
        // Ø§Ø³ØªØ«Ù†Ø§Ø¡ checkboxes Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
        if (!cb.id.includes('select-all-')) {
          cb.checked = select;
        }
      });
      updateSelectedCommittees();
    }

    function toggleCommitteeDropdown() {
      const dropdown = document.getElementById('committeeDropdown');
      dropdown.classList.toggle('show');
    }

    function updateSelectedCommittees() {
      const checkboxes = document.querySelectorAll('#committeeDropdown input[type="checkbox"]');
      selectedCommittees = Array.from(checkboxes)
        .filter(cb => cb.checked && !cb.id.includes('select-all-'))
        .map(cb => cb.value);
      
      const text = document.getElementById('selectedCommitteesText');
      if (selectedCommittees.length > 0) {
        const raisedCount = selectedCommittees.filter(c => c.toLowerCase().includes('Ù…Ø±ÙÙˆØ¹')).length;
        const spentCount = selectedCommittees.filter(c => c.toLowerCase().includes('Ù…Ù†ØµØ±Ù')).length;
        const otherCount = selectedCommittees.length - raisedCount - spentCount;
        
        let types = [];
        if (raisedCount > 0) types.push(`${raisedCount} Ù…Ø±ÙÙˆØ¹Ø©`);
        if (spentCount > 0) types.push(`${spentCount} Ù…Ù†ØµØ±ÙØ©`);
        if (otherCount > 0) types.push(`${otherCount} Ø£Ø®Ø±Ù‰`);
        
        text.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedCommittees.length} Ù„Ø¬Ù†Ø© (${types.join('ØŒ ')})`;
      } else {
        text.textContent = '';
      }
      
      applyAllFilters();
    }

    function applyAllFilters() {
      try {
        const branch = document.getElementById('filterBranch').value;
        const review = document.getElementById('filterReview').value;
        const supervisor = document.getElementById('filterSupervisor').value;
        const admin = document.getElementById('filterAdmin').value;
        const officer = document.getElementById('filterOfficer').value;
        const transferred = document.getElementById('filterTransferred').value;

        filteredData = allData.filter(row => {
          // Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ø§Ù…Ø©
          const rowBranch = row["ÙØ±Ø¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„Ø£ØµÙ„ÙŠØ©"] || row["Ø§Ù„ÙØ±Ø¹"];
          if (branch && rowBranch !== branch) return false;
          if (review && row["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"] !== review) return false;
          if (supervisor && row["Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"] !== supervisor) return false;
          if (admin && row["Ø§Ù„Ø§Ø¯Ø§Ø±Ø©"] !== admin) return false;
          if (officer && row["Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØµØ§Ø¦Ù‰"] !== officer) return false;
          if (transferred !== '') {
            const isTransferred = row["ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„"] === true || row["ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„"] === 'true';
            if (transferred === 'true' && !isTransferred) return false;
            if (transferred === 'false' && isTransferred) return false;
          }
          
          // ÙÙ„ØªØ± Ø§Ù„Ù„Ø¬Ø§Ù† (multi-select)
          if (selectedCommittees.length > 0) {
            const committeeNumber = row["Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©"];
            if (!committeeNumber || !selectedCommittees.includes(committeeNumber)) return false;
          }

          // ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
          const nationalId = row["Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„"] || row["Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©"];
          if (columnFilters.nationalId && !nationalId?.toLowerCase().includes(columnFilters.nationalId)) return false;
          if (columnFilters.clientId && !row["ÙƒÙˆØ¯_Ø§Ù„Ø¹Ù…ÙŠÙ„"]?.toLowerCase().includes(columnFilters.clientId)) return false;
          if (columnFilters.clientName) {
            const name1 = row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„"]?.toLowerCase() || '';
            const name2 = row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„_Ù…Ù†_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"]?.toLowerCase() || '';
            const name3 = row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„_Ø§Ù„Ø¨Ù†ÙƒÙŠ"]?.toLowerCase() || '';
            if (!name1.includes(columnFilters.clientName) && !name2.includes(columnFilters.clientName) && !name3.includes(columnFilters.clientName)) return false;
          }
          const project = row["Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"] || row["Ù…Ø´Ø±ÙˆØ¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©"] || row["Ø§Ø³Ù…_Ø§Ù„Ù…Ø´Ø±ÙˆØ¹_Ø§Ù„Ù…Ø±ÙÙˆØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ"];
          if (columnFilters.project && !project?.toLowerCase().includes(columnFilters.project)) return false;
          if (columnFilters.guarantorId && !row["Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¶Ø§Ù…Ù†"]?.toLowerCase().includes(columnFilters.guarantorId)) return false;
          if (columnFilters.guarantorName && !row["Ø§Ø³Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†"]?.toLowerCase().includes(columnFilters.guarantorName)) return false;

          return true;
        });

        renderTable(filteredData);
        updateStats(filteredData);
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ applyAllFilters:', err);
      }
    }

    function updateColumnFilter(field, value) {
      columnFilters[field] = value.toLowerCase();
      
      // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚
      if (searchTimeout) {
        clearTimeout(searchTimeout);
      }
      
      // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 1 Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø­Ø«
      searchTimeout = setTimeout(() => {
        applyAllFilters();
      }, 1000);
    }
    
    function searchOnEnter(event, field, value) {
      if (event.key === 'Enter') {
        if (searchTimeout) {
          clearTimeout(searchTimeout);
        }
        columnFilters[field] = value.toLowerCase();
        applyAllFilters();
      }
    }

    function resetFilters() {
      document.getElementById('filterBranch').value = '';
      document.getElementById('filterReview').value = '';
      document.getElementById('filterSupervisor').value = '';
      document.getElementById('filterAdmin').value = '';
      document.getElementById('filterOfficer').value = '';
      document.getElementById('filterTransferred').value = '';
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† checkboxes Ø§Ù„Ù„Ø¬Ø§Ù†
      const checkboxes = document.querySelectorAll('#committeeDropdown input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = false);
      selectedCommittees = [];
      document.getElementById('selectedCommitteesText').textContent = '';
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
      columnFilters = {
        nationalId: '',
        clientId: '',
        clientName: '',
        project: '',
        guarantorId: '',
        guarantorName: ''
      };
      
      filteredData = [...allData];
      renderTable(filteredData);
      updateStats(filteredData);
    }

    function updateStats(data) {
      document.getElementById('totalRecords').textContent = data.length.toLocaleString('ar-EG');
      
      const total = data.reduce((sum, row) => {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
        const amount = parseFloat(row["Ø§Ù„Ù…Ø¨Ù„Øº_Ø§Ù„Ù…Ø±ÙÙˆØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ"]) || 
                      parseFloat(row["Ù‚ÙŠÙ…Ø©_Ø§Ù„Ù‚Ø±Ø¶_Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©_Ø§Ù„Ø¨Ù†ÙƒÙŠØ©"]) || 
                      parseFloat(row["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"]) || 
                      parseFloat(row["Ø§Ù„Ù…Ø¨Ù„Øº_Ø§Ù„Ù…Ø·Ù„ÙˆØ¨_ÙÙŠ_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„Ø£ØµÙ„ÙŠØ©"]) || 0;
        return sum + amount;
      }, 0);
      
      document.getElementById('totalAmount').textContent = total.toLocaleString('ar-EG') + ' Ø¬.Ù…';
    }

    function renderTable(data) {
      const container = document.getElementById('tableContainer');
      
      if (!data || data.length === 0) {
        container.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>';
        return;
      }

      let html = `
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>
                Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
                <input type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¶ØºØ· Enter..." 
                  value="${columnFilters.nationalId}" 
                  oninput="updateColumnFilter('nationalId', this.value)"
                  onkeypress="searchOnEnter(event, 'nationalId', this.value)" />
              </th>
              <th>
                ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„
                <input type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¶ØºØ· Enter..." 
                  value="${columnFilters.clientId}" 
                  oninput="updateColumnFilter('clientId', this.value)"
                  onkeypress="searchOnEnter(event, 'clientId', this.value)" />
              </th>
              <th>
                Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
                <input type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¶ØºØ· Enter..." 
                  value="${columnFilters.clientName}" 
                  oninput="updateColumnFilter('clientName', this.value)"
                  onkeypress="searchOnEnter(event, 'clientName', this.value)" />
              </th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
              <th>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</th>
              <th>Ø§Ù„Ø§Ø³Ù… Ù…Ù† I-Score</th>
              <th>
                Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                <input type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¶ØºØ· Enter..." 
                  value="${columnFilters.project}" 
                  oninput="updateColumnFilter('project', this.value)"
                  onkeypress="searchOnEnter(event, 'project', this.value)" />
              </th>
              <th>
                Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¶Ø§Ù…Ù†
                <input type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¶ØºØ· Enter..." 
                  value="${columnFilters.guarantorId}" 
                  oninput="updateColumnFilter('guarantorId', this.value)"
                  onkeypress="searchOnEnter(event, 'guarantorId', this.value)" />
              </th>
              <th>
                Ø§Ø³Ù… Ø§Ù„Ø¶Ø§Ù…Ù†
                <input type="text" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¶ØºØ· Enter..." 
                  value="${columnFilters.guarantorName}" 
                  oninput="updateColumnFilter('guarantorName', this.value)"
                  onkeypress="searchOnEnter(event, 'guarantorName', this.value)" />
              </th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±ÙÙˆØ¹</th>
              <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø±Ø¶</th>
              <th>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</th>
              <th>Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</th>
              <th>ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„</th>
              <th>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</th>
              <th>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</th>
              <th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tableBody">
      `;

      data.forEach((row, idx) => {
        const getCellClass = (value) => {
          if (!value) return '';
          const lowerValue = value.toString().toLowerCase();
          if (lowerValue.includes('Ù…Ù‚Ø¨ÙˆÙ„')) return 'approved-cell';
          if (lowerValue.includes('Ù…Ø±ÙÙˆØ¶') || lowerValue.includes('Ù…Ù„ØºÙŠ')) return 'rejected-cell';
          return '';
        };

        const reviewClass = getCellClass(row["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"]);
        const supervisorClass = getCellClass(row["Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"]);
        const adminClass = getCellClass(row["Ø§Ù„Ø§Ø¯Ø§Ø±Ø©"]);
        
        // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù„Ø¬Ù†Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        const committeeNumber = row["Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©"] || '';
        const committeeClass = committeeNumber.toLowerCase().includes('Ù…Ø±ÙÙˆØ¹') ? 'approved-cell' : 
                               committeeNumber.toLowerCase().includes('Ù…Ù†ØµØ±Ù') ? 'rejected-cell' : '';

        html += `
          <tr>
            <td>${idx + 1}</td>
            <td>${row["Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„"] || row["Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©"] || 'â€”'}</td>
            <td>${row["ÙƒÙˆØ¯_Ø§Ù„Ø¹Ù…ÙŠÙ„"] || 'â€”'}</td>
            <td>${row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„"] || row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„_Ù…Ù†_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"] || row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„_Ø§Ù„Ø¨Ù†ÙƒÙŠ"] || 'â€”'}</td>
            <td style="font-size: 10px;">${row["Ø±Ù‚Ù…_Ø§Ù„Ø­Ø³Ø§Ø¨_Ø§Ù„Ø¨Ù†ÙƒÙŠ"] || row["Ø±Ù‚Ù…_Ø§Ù„Ø­Ø³Ø§Ø¨_Ù…Ù†_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"] || 'â€”'}</td>
            <td style="font-size: 9px;">${row["Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹"] ? row["Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹"].substring(0, 20) + '...' : 'â€”'}</td>
            <td>${row["Ø§Ù„Ø§Ø³Ù…_Ù…Ù†_Ø§Ù„Ø§ÙŠ_Ø³ÙƒÙˆØ±"] || 'â€”'}</td>
            <td>${row["Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"] || row["Ù…Ø´Ø±ÙˆØ¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©"] || row["Ø§Ø³Ù…_Ø§Ù„Ù…Ø´Ø±ÙˆØ¹_Ø§Ù„Ù…Ø±ÙÙˆØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ"] || 'â€”'}</td>
            <td>${row["Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¶Ø§Ù…Ù†"] || 'â€”'}</td>
            <td>${row["Ø§Ø³Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†"] || 'â€”'}</td>
            <td style="font-weight: bold; color: #667eea;">${formatCurrency(row["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"] || row["Ø§Ù„Ù…Ø¨Ù„Øº_Ø§Ù„Ù…Ø·Ù„ÙˆØ¨_ÙÙŠ_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„Ø£ØµÙ„ÙŠØ©"])}</td>
            <td style="font-weight: bold; color: #4caf50;">${formatCurrency(row["Ø§Ù„Ù…Ø¨Ù„Øº_Ø§Ù„Ù…Ø±ÙÙˆØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ"])}</td>
            <td style="font-weight: bold; color: #2196f3;">${formatCurrency(row["Ù‚ÙŠÙ…Ø©_Ø§Ù„Ù‚Ø±Ø¶_Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©_Ø§Ù„Ø¨Ù†ÙƒÙŠØ©"])}</td>
            <td style="font-weight: bold; color: #ff9800;">${formatCurrency(row["Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ_Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©_Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©"])}</td>
            <td>${row["Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØµØ§Ø¦Ù‰"] || 'â€”'}</td>
            <td>${row["ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„"] ? '<span style="color: #2ecc71;">âœ“ Ù†Ø¹Ù…</span>' : '<span style="color: #e74c3c;">âœ— Ù„Ø§</span>'}</td>
            <td class="${reviewClass}">${row["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"] || 'â€”'}</td>
            <td class="${supervisorClass}">${row["Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"] || 'â€”'}</td>
            <td class="${adminClass}">${row["Ø§Ù„Ø§Ø¯Ø§Ø±Ø©"] || 'â€”'}</td>
            <td class="${committeeClass}">${committeeNumber || 'â€”'}</td>
            <td><button class="expand-btn" onclick="toggleDetail(${idx}, event)">ØªÙØ§ØµÙŠÙ„</button></td>
          </tr>
          <tr class="detail-row" id="detail-${idx}">
            <td colspan="20">
              <div class="detail-container">
                <div class="detail-row-sections">
                  <div class="detail-section">
                    <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h3>
                    ${renderDetailItems(row, [
                      ['Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ£Ø®ÙŠØ±', 'Ø¹Ø¯Ø¯ Ø§ÙŠØ§Ù… Ø§Ù„ØªØ§Ø®ÙŠØ±'],
                      ['Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù‚Ø³Ø§Ø·'],
                      ['Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'Ø§Ù„Ù…Ù†Ø·Ù‚Ù‡'],
                      ['Ø§Ù„ÙØ±Ø¹', 'ÙØ±Ø¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„Ø£ØµÙ„ÙŠØ©'],
                      ['Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„Ø²ÙŠØ§Ø±Ø©', 'Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„Ø²ÙŠØ§Ø±Ù‡'],
                      ['Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„', 'Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„Ø§Ø¯Ø®Ø§Ù„'],
                      ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„', 'ØªØ§Ø±ÙŠØ®_Ø¥Ù†Ø´Ø§Ø¡_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', true]
                    ])}
                  </div>
                  <div class="detail-section">
                    <h3>ğŸ’° Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¶</h3>
                    ${renderDetailItems(row, [
                      ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø¶', 'ØªØ§Ø±ÙŠØ®_Ø§Ù„Ù‚Ø±Ø¶'],
                      ['Ø£Ø®ØµØ§Ø¦ÙŠ Ø§Ù„Ù‚Ø±Ø¶', 'Ø§Ø®ØµØ§Ø¦Ù‰_Ø§Ù„Ù‚Ø±Ø¶'],
                      ['ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'ÙƒÙˆØ¯_Ø§Ù„Ø¹Ù…ÙŠÙ„'],
                      ['Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø§Ù„Ù†Ø´Ø§Ø·_Ø§Ù„Ø«Ø§Ù†Ù‰'],
                      ['ÙØ±Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'ÙØ±Ø¹_Ø§Ù„Ø¹Ù…ÙŠÙ„_Ù…Ù†_Ø§Ù„Ù‚Ø±ÙˆØ¶']
                    ])}
                  </div>
                  <div class="detail-section">
                    <h3>ğŸ¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ</h3>
                    ${renderDetailItems(row, [
                      ['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±ÙÙˆØ¹', 'Ø§Ù„Ù…Ø¨Ù„Øº_Ø§Ù„Ù…Ø±ÙÙˆØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ', false, '#4caf50', '', true],
                      ['Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø±Ø¶', 'Ù‚ÙŠÙ…Ø©_Ø§Ù„Ù‚Ø±Ø¶_Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©_Ø§Ù„Ø¨Ù†ÙƒÙŠØ©', false, '#2196f3', '', true],
                      ['Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©', 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ_Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©_Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©', false, '#ff9800', '', true],
                      ['Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ', 'Ø±Ù‚Ù…_Ø§Ù„Ø­Ø³Ø§Ø¨_Ø§Ù„Ø¨Ù†ÙƒÙŠ'],
                      ['ÙƒÙˆØ¯ Ø§Ù„ÙØ±Ø¹', 'ÙƒÙˆØ¯_ÙØ±Ø¹_Ø§Ù„Ø±ÙØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ'],
                      ['ÙƒÙˆØ¯ Ø§Ù„Ø¨Ù†Ùƒ', 'ÙƒÙˆØ¯ Ø§Ù„Ø¨Ù†Ùƒ Ø«Ø§Ø¨Øª']
                    ])}
                  </div>
                  <div class="detail-section">
                    <h3>ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                    ${renderDetailItems(row, [
                      ['Ø§Ù„Ø§Ø³Ù… Ù…Ù† I-Score', 'Ø§Ù„Ø§Ø³Ù…_Ù…Ù†_Ø§Ù„Ø§ÙŠ_Ø³ÙƒÙˆØ±'],
                      ['Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨', 'Ø±Ù‚Ù…_Ø§Ù„Ø­Ø³Ø§Ø¨_Ù…Ù†_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'],
                      ['Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', 'Ù†ØªÙŠØ¬Ø©_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'],
                      ['Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø±Ù‚Ù…ÙŠ', 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…_Ø§Ù„Ø±Ù‚Ù…Ù‰'],
                      ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…', 'ØªØ§Ø±ÙŠØ®_Ø§Ø³ØªØ¹Ù„Ø§Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„'],
                      ['ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…', 'ØªØ¹Ù„ÙŠÙ‚_Ø§Ø³ØªØ¹Ù„Ø§Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„', false, '#764ba2']
                    ])}
                  </div>
                </div>
                <div class="detail-row-sections">
                  <div class="detail-section">
                    <h3>ğŸ‘¥ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¶Ø§Ù…Ù†</h3>
                    ${renderDetailItems(row, [
                      ['Ø§Ø³Ù… Ø§Ù„Ø¶Ø§Ù…Ù†', 'Ø§Ø³Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†'],
                      ['Ø§Ù„Ø§Ø³Ù… Ù…Ù† I-Score', 'Ø§Ø³Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†_Ù…Ù†_Ø§Ù„Ø§ÙŠ_Ø³ÙƒÙˆØ±'],
                      ['Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', 'Ù†ØªÙŠØ¬Ø©_ØªÙ‚ÙŠÙŠÙ…_Ø§Ù„Ø¶Ø§Ù…Ù†'],
                      ['Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø±Ù‚Ù…ÙŠ', 'ØªÙ‚ÙŠÙŠÙ…_Ø±Ù‚Ù…Ù‰_Ø§Ù„Ø¶Ø§Ù…Ù†'],
                      ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…', 'ØªØ§Ø±ÙŠØ®_Ø§Ø³ØªØ¹Ù„Ø§Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†'],
                      ['ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…', 'ØªØ¹Ù„ÙŠÙ‚_Ø§Ø³ØªØ¹Ù„Ø§Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†', false, '#764ba2']
                    ])}
                  </div>
                  <div class="detail-section">
                    <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
                    ${renderDetailItems(row, [
                      ['Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¨Ù†ÙƒÙŠ', 'Ø§Ø³Ù…_Ø§Ù„Ù…Ø´Ø±ÙˆØ¹_Ø§Ù„Ù…Ø±ÙÙˆØ¹_Ø§Ù„Ø¨Ù†ÙƒÙŠ'],
                      ['Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'Ù…Ø´Ø±ÙˆØ¹_Ø§Ù„Ø¹Ù…Ù„ÙŠØ©_Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©'],
                      ['Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª', 'Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹', false, '', '9px']
                    ])}
                  </div>
                </div>
                <div class="detail-section-full">
                  <h3>âœ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h3>
                  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div>${renderDetailItems(row, [
                      ['Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©'],
                      ['Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©']
                    ], false)}</div>
                    <div>${renderDetailItems(row, [
                      ['Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©'],
                      ['ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'ØªØ¹Ù„ÙŠÙ‚ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©']
                    ], false)}</div>
                    <div>${renderDetailItems(row, [
                      ['Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'Ø§Ù„Ø§Ø¯Ø§Ø±Ø©'],
                      ['Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§Ø¯Ø§Ø±Ø©'],
                      ['ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„', 'ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„', false, '', '', true]
                    ], false)}</div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
      });

      html += `</tbody></table>`;
      container.innerHTML = html;
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    function formatCurrency(value) {
      if (!value && value !== 0) return 'â€”';
      const num = parseFloat(value);
      if (isNaN(num)) return value;
      return num.toLocaleString('ar-EG') + ' Ø¬.Ù…';
    }

    function renderDetailItems(row, items, showContainer = true) {
      let html = showContainer ? '' : '';
      items.forEach(item => {
        const [label, key, isDate = false, color = '', fontSize = '', isCurrency = false] = item;
        let value = row[key] || 'â€”';
        
        if (isDate && value !== 'â€”') {
          value = new Date(value).toLocaleDateString('ar-EG');
        } else if (isCurrency && value !== 'â€”') {
          value = formatCurrency(value);
        }
        
        const style = color ? `style="color: ${color}; font-weight: bold;"` : '';
        const fontStyle = fontSize ? `style="font-size: ${fontSize};"` : '';
        
        html += `
          <div class="detail-item">
            <span class="detail-label" ${style}>${label}:</span>
            <span class="detail-value" ${fontStyle}>${value}</span>
          </div>
        `;
      });
      return html;
    }

    function toggleDetail(index, event) {
      const detailRow = document.getElementById(`detail-${index}`);
      const btn = event.target;
      if (detailRow.style.display === 'none' || !detailRow.style.display) {
        detailRow.style.display = 'table-row';
        btn.textContent = 'Ø¥Ø®ÙØ§Ø¡';
        btn.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
      } else {
        detailRow.style.display = 'none';
        btn.textContent = 'ØªÙØ§ØµÙŠÙ„';
        btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', function() {
      init().catch(err => {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', err);
        showError(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: ${err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
      });
    });
  </script>
</body>
</html>