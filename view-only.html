<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø±ÙˆØ¶</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* ØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ ÙƒØ§ÙØ© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ÙƒÙ…Ø§ Ù‡ÙŠ */
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 20px; min-height: 100vh; }
    .container { max-width: 1900px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
    h2 { text-align: center; color: #2c3e50; margin-top: 0; font-size: 28px; margin-bottom: 10px; }
    .stats { display: flex; gap: 20px; justify-content: center; margin-bottom: 25px; flex-wrap: wrap; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border-radius: 12px; text-align: center; min-width: 200px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .stat-card .label { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
    .stat-card .value { font-size: 24px; font-weight: bold; }
    .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 1px solid #eee; }
    .filter-group { display: flex; flex-direction: column; gap: 5px; }
    .filter-group label { font-size: 13px; font-weight: bold; color: #666; }
    select, input { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: all 0.3s; }
    select:focus, input:focus { border-color: #667eea; outline: none; }
    .table-wrapper { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; min-width: 1200px; }
    th { background: #f8f9fa; padding: 15px 10px; text-align: right; font-size: 13px; font-weight: bold; color: #2c3e50; border-bottom: 2px solid #eee; position: sticky; top: 0; z-index: 10; }
    td { padding: 12px 10px; border-bottom: 1px solid #eee; font-size: 13px; color: #444; }
    tr:hover { background-color: #fcfcfc; }
    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; }
    .detail-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
    .detail-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(118, 75, 162, 0.3); }
    .detail-row { display: none; background-color: #f9faff; }
    .detail-content { padding: 30px; border: 2px solid #667eea; border-radius: 12px; margin: 10px; background: white; }
    .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; }
    .detail-section h4 { color: #764ba2; margin: 0 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid #f0f0f0; font-size: 15px; }
    .detail-item { display: flex; margin-bottom: 8px; font-size: 13px; }
    .detail-label { font-weight: bold; color: #666; width: 140px; }
    .detail-value { color: #2c3e50; flex: 1; }
    .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; font-size: 20px; font-weight: bold; color: #764ba2; }
  </style>
</head>
<body>

  <div id="loading" class="loading-overlay">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

  <div class="container">
    <h2>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h2>
    
    <div class="stats">
      <div class="stat-card"><div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div><div class="value" id="count-total">0</div></div>
      <div class="stat-card"><div class="label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</div><div class="value" id="sum-amount">0</div></div>
    </div>

    <div class="filters">
      <div class="filter-group"><label>Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type="text" id="search-name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…..."></div>
      <div class="filter-group"><label>Ø§Ù„ÙØ±Ø¹</label><select id="filter-branch"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
      <div class="filter-group"><label>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</label><select id="filter-review"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
      <div class="filter-group"><label>ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„</label><select id="filter-transfer"><option value="">Ø§Ù„ÙƒÙ„</option><option value="true">Ù†Ø¹Ù…</option><option value="false">Ù„Ø§</option></select></div>
    </div>

    <div class="table-wrapper">
      <table id="data-table">
        <thead>
          <tr>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
            <th>Ø§Ù„ÙØ±Ø¹</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
            <th>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</th>
            <th>Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</th>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    // ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© Ù„ØªØ¬Ù†Ø¨ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ÙƒØ±Ø±
    (function() {
      "use strict";

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      const SUPABASE_URL = 'https://akjyrmmqsnxdbkslxmvb.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFranlybW1xc254ZGJrc2x4bXZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4ODUxODcsImV4cCI6MjA4MDQ2MTE4N30.EuTd_i9fEecFGJG89PhRa3z68k5x6nflOW6fvqvMQJM';
      
      const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      let allData = [];

      async function init() {
        try {
          const { data, error } = await _supabase
            .from('operations_with_details')
            .select('*')
            .order('created_at', { ascending: false });

          if (error) throw error;
          allData = data || [];
          
          fillFilters();
          renderTable(allData);
          document.getElementById('loading').style.display = 'none';
        } catch (err) {
          console.error('Error:', err);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
      }

      function fillFilters() {
        const branches = [...new Set(allData.map(item => item["Ø§Ù„ÙØ±Ø¹"]))].filter(Boolean);
        const reviews = [...new Set(allData.map(item => item["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"]))].filter(Boolean);
        
        const branchSelect = document.getElementById('filter-branch');
        branches.forEach(b => branchSelect.add(new Option(b, b)));

        const reviewSelect = document.getElementById('filter-review');
        reviews.forEach(r => reviewSelect.add(new Option(r, r)));

        document.querySelectorAll('.filters input, .filters select').forEach(el => {
          el.addEventListener('input', applyFilters);
        });
      }

      function applyFilters() {
        const nameSearch = document.getElementById('search-name').value.toLowerCase();
        const branch = document.getElementById('filter-branch').value;
        const review = document.getElementById('filter-review').value;
        const transfer = document.getElementById('filter-transfer').value;

        const filtered = allData.filter(item => {
          const matchName = (item["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„"] || "").toLowerCase().includes(nameSearch);
          const matchBranch = !branch || item["Ø§Ù„ÙØ±Ø¹"] === branch;
          const matchReview = !review || item["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"] === review;
          const matchTransfer = !transfer || String(item["ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„"]) === transfer;
          return matchName && matchBranch && matchReview && matchTransfer;
        });

        renderTable(filtered);
      }

      function renderTable(data) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';
        
        let totalAmount = 0;
        document.getElementById('count-total').textContent = data.length;

        data.forEach((row, index) => {
          totalAmount += parseFloat(row["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"] || 0);
          
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${new Date(row.created_at).toLocaleDateString('ar-EG')}</td>
            <td>${row["Ø§Ù„ÙØ±Ø¹"] || 'â€”'}</td>
            <td style="font-weight:bold">${row["Ø§Ø³Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„"] || 'â€”'}</td>
            <td>${row["Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„"] || 'â€”'}</td>
            <td style="color:#764ba2; font-weight:bold">${(row["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"] || 0).toLocaleString()}</td>
            <td>${row["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"] || 'â€”'}</td>
            <td>${row["Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"] || 'â€”'}</td>
            <td>${row["Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©"] || 'â€”'}</td>
            <td><button class="detail-btn" onclick="toggleDetail(${index})">ØªÙØ§ØµÙŠÙ„</button></td>
          `;
          tbody.appendChild(tr);

          // ØµÙ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®ÙÙŠ (Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©)
          const detailTr = document.createElement('tr');
          detailTr.id = `detail-${index}`;
          detailTr.className = 'detail-row';
          detailTr.innerHTML = `
            <td colspan="9">
              <div class="detail-content">
                <div class="detail-grid">
                  <div class="detail-section">
                    <h4>ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                    <div class="detail-item"><span class="detail-label">ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„:</span><span class="detail-value">${row["ÙƒÙˆØ¯_Ø§Ù„Ø¹Ù…ÙŠÙ„"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</span><span class="detail-value">${row["Ø±Ù‚Ù…_Ø§Ù„Ø­Ø³Ø§Ø¨_Ù…Ù†_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</span><span class="detail-value">${row["Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span><span class="detail-value">${row["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"] || 'â€”'}</span></div>
                  </div>
                  <div class="detail-section">
                    <h4>ğŸ‘¥ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø§Ù…Ù†</h4>
                    <div class="detail-item"><span class="detail-label">Ø§Ø³Ù… Ø§Ù„Ø¶Ø§Ù…Ù†:</span><span class="detail-value">${row["Ø§Ø³Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¶Ø§Ù…Ù†:</span><span class="detail-value">${row["Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¶Ø§Ù…Ù†"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ø§Ø³Ù… Ø§Ù„Ø¶Ø§Ù…Ù† (IScore):</span><span class="detail-value">${row["Ø§Ø³Ù…_Ø§Ù„Ø¶Ø§Ù…Ù†_Ù…Ù†_Ø§Ù„Ø§ÙŠ_Ø³ÙƒÙˆØ±"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¶Ø§Ù…Ù†:</span><span class="detail-value">${row["ØªÙ‚ÙŠÙŠÙ…_Ø±Ù‚Ù…Ù‰_Ø§Ù„Ø¶Ø§Ù…Ù†"] || 'â€”'}</span></div>
                  </div>
                  <div class="detail-section">
                    <h4>ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</h4>
                    <div class="detail-item"><span class="detail-label">Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span><span class="detail-value">${row["Ù†ØªÙŠØ¬Ø©_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:</span><span class="detail-value">${row["ØªØ¹Ù„ÙŠÙ‚_Ø§Ø³ØªØ¹Ù„Ø§Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span><span class="detail-value" style="font-size:10px">${row["Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹"] || 'â€”'}</span></div>
                  </div>
                  <div class="detail-section">
                    <h4>âš–ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</h4>
                    <div class="detail-item"><span class="detail-label">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©:</span><span class="detail-value">${row["Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:</span><span class="detail-value">${row["Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:</span><span class="detail-value">${row["ØªØ¹Ù„ÙŠÙ‚ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"] || 'â€”'}</span></div>
                    <div class="detail-item"><span class="detail-label">ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span><span class="detail-value">${row["ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„"] ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span></div>
                  </div>
                </div>
              </div>
            </td>
          `;
          tbody.appendChild(detailTr);
        });

        document.getElementById('sum-amount').textContent = totalAmount.toLocaleString() + ' Ø¬.Ù…';
      }

      // ØªØ¹Ø±ÙŠÙ Ø¯Ø§Ù„Ø© toggleDetail ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù… Ù„ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø²Ø± Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§
      window.toggleDetail = function(index) {
        const row = document.getElementById(`detail-${index}`);
        row.style.display = row.style.display === 'table-row' ? 'none' : 'table-row';
      };

      init();
    })();
  </script>
</body>
</html>